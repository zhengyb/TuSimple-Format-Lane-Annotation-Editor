# 车道线标注工具产品需求文档（PRD）

## 一、产品名称
车道线标注工具（Lane Annotation Editor）

## 二、产品背景与目标
为了提升车道线检测模型的训练质量与精度，研发一款支持 **TuSimple 标注格式** 的可视化标注工具，用于人工标注和修正图像中的车道线像素点。

## 三、核心功能需求

### 3.1 文件读取与写入
- 支持打开 `.json` 格式的 **TuSimple annotation 文件**。
- 支持导入对应的车道线图像（按 annotation 中 `raw_file` 字段）。使用“Previous Image"和”Next Image“两个按钮切换图像。
- 支持将修改后的标注重新保存为符合 TuSimple 格式的 `.json` 文件。

### 3.2 图像展示与选择
- 使用“Previous Image"和”Next Image“两个按钮切换图像。显示当前image的完整路径和文件名称。
- 加载图像时自动显示已有标注的车道线。

### 3.3 车道线标注与修改
- 绘制tusimple数据集定义的参考线；
- 支持对每一条车道线进行选择、添加、删除、编辑操作。
- 支持基于鼠标点选方式输入车道线像素点 `(x, y)`。
- 支持线性插值绘制车道线。
- 支持不同车道线使用不同颜色区分。
- 支持撤销与重做操作。

### 3.4 数据结构与 TuSimple 格式映射
- 每张图片的 annotation 包含：
  - `raw_file`: 图像路径字符串
  - `lanes`: `[[x1, x2, ..., xn], [...], ...]`，每条车道线的所有 x 坐标数组（对应固定的 y 值）
  - `h_samples`: `[y1, y2, ..., yn]`，纵向采样点数组
- 工具应根据 `h_samples` 固定 y 值，在图上标注对应的 x 值或插值估计。

### 3.5 用户交互界面
- **顶部**：选择annotation文件，显示当前image名称，选择image的按钮。保存按钮。
- **中间**：主标注区，显示当前图像与车道线。
- **右侧**：标注信息面板，展示并编辑：
  - 当前车道线编号与颜色
  - 当前像素点位置（x, y）
  - 按钮：添加点、删除点、保存、撤销、重做
- **顶部菜单**：
  - 打开 TuSimple 标注文件
  - 保存标注

### 3.6 标注数据保存
- 支持将标注结果另存为新的 `.json` 文件或覆盖原文件。
- 保存前应自动校验格式完整性（如 `lanes` 与 `h_samples` 对应关系一致）。

## 四、技术规格

| 项目       | 内容                          |
|------------|-------------------------------|
| 前端框架   | PyQt |
| 后端语言   | Python 3.8+                   |
| 图像处理   | OpenCV                        |
| 数据格式   | TuSimple JSON Annotation      |
| 插值算法   | 线性插值             |
| 支持系统   | Ubuntu               |

## 五、非功能性需求
- 操作流畅，图像加载时间小于 300ms。
- 保存前提供标注预览确认。
- 允许多图同时加载。
- 支持快捷键（如 Ctrl+Z 撤销，Ctrl+S 保存）。

## 六、未来扩展功能（可选）
- 支持多种车道线数据集格式（如 CULane、BDD100K）。
- 支持初步自动标注辅助功能（如调用预训练模型）。
- 支持多人协作标注（Web 多用户模式）。
- 标注质量统计与可视化报告。
